"""
âƒ `{i}Ø³Ø¨Ø§Ù…` <Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„> <Ø±Ø³Ø§Ù„ØªÙƒ>
  `{i}Ø³Ø¨Ø§Ù…` <Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„> <Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø©
    **Ù„Ù€ ØªÙƒØ±Ø§Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù‡Ø§ Ø§Ù„Ø§Ù…Ø± Ø§ÙƒØ«Ø± Ø±Ù‚Ù… Ù‡Ùˆ 99**

âƒ `{i}Ù…ÙƒØ±Ø±` <Ø§Ù„ÙˆÙ‚Øª Ø¨ÙŠÙ† Ø§Ù„Ø§Ø±Ø³Ø§Ù„> <Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø±Ø³Ø§Ù„> <Ø§Ù„Ø±Ø³Ø§Ù„Ø©>
    **Ù„Ù€ ØªÙƒØ±Ø§Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯Ø¯ Ù…Ø¹ÙŠÙ† ÙÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù„ÙƒÙ† Ø¨ÙŠÙ† Ø§Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø®Ø±Ù‰ ÙˆÙ‚Øª Ù…Ø¹ÙŠÙ† Ø¬Ø±Ø¨ Ø§Ø±Ø³Ù„**   `. Ù…ÙƒØ±Ø± 2 5 Ù…Ø±Ø­Ø¨Ø§`

âƒ `{i}ÙØµØ®`<Ø¬Ù…Ù„Ø©>
   **Ù„Ù€ ØªÙØµÙŠØ® Ø§Ù„Ø¬Ù…Ù„Ø© ÙˆØ¬Ø¹Ù„Ù‡Ø§ Ø§Ù…Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªÙƒØªØ¨ Ø¨Ø´ÙƒÙ„ Ø­Ø±Ù Ø­Ø±Ù**
   
âƒ `{i}Ø§ÙŠÙ‚Ø§Ù Ù…ÙƒØ±Ø±`
   **Ù„Ù€ Ø§ÙŠÙ‚Ø§Ù Ø§Ù…Ø± Ù…ÙƒØ±Ø±/Ù…Ø¤Ù‚Øª ÙÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©**

   âš ï¸ **Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©: Ù‚Ø¯ ÙŠØ±Ù‰ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø§ÙˆØ§Ù…Ø± Ø§Ù„Ø³Ø¨Ø§Ù…/Ø§Ù„ØªÙƒØ±Ø§Ø± Ù…Ø®Ø§Ù„ÙØ© Ù„Ø³ÙŠØ§Ø³ØªÙ‡ Ùˆ Ù‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ø§Ù„Ù‰ Ø­Ø¸Ø± Ø§Ùˆ Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ù Ø§Ù†Øª Ø§Ù„Ù…Ø³ÙˆØ¤Ù„ Ø§Ù„ÙˆØ­ÙŠØ¯ Ø¹Ù† Ù…Ø§ Ø³ÙŠØ­ØµÙ„ Ù„Ø­Ø³Ø§Ø¨Ùƒ Ù„Ø§Ù† ÙÙŠ Ø³ÙŠØ§Ø³Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… ÙŠÙ…Ù†Ø¹ Ø¹Ù…Ù„ Ø±Ø³Ø§Ø¦Ù„ Ù…ÙƒØ±Ø±Ø© Ùˆ Ø³Ø¨Ø§Ù…**ğŸ§¸â™¥ï¸
"""

import asyncio

from .. import HNDLR, eod, jmthon_cmd, JmdB

@jmthon_cmd(pattern="ÙØµØ® ([\s\S]*)")
async def typewriter(typew):
    message = typew.pattern_match.group(1)
    sleep_time = 0.2
    typing_symbol = "|"
    old_text = ""
    typew = await typew.eor(typing_symbol)
    await asyncio.sleep(sleep_time)
    for character in message:
        old_text = old_text + "" + character
        typing_text = old_text + "" + typing_symbol
        await typew.eor(typing_text)
        await asyncio.sleep(sleep_time)
        await typew.eor(old_text)
        await asyncio.sleep(sleep_time)



@jmthon_cmd(pattern="Ø³Ø¨Ø§Ù…")
async def spamnormal(e):
    message = e.text
    if e.reply_to:
        if not len(message.split()) >= 2:
            return await eod(e, "**âŒ”âˆ® ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø£Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ù…Ø± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­**")
        spam_message = await e.get_reply_message()
    else:
        if not len(message.split()) >= 3:
            return await eod(e, "**âŒ”âˆ® ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ÙˆØ¶Ø¹ Ø±Ø³Ø§Ù„Ø© Ù…Ø¹ Ø§Ù„Ø§Ù…Ø± Ø§Ùˆ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø§Ù…Ø±**")
        spam_message = message.split(maxsplit=2)[2]
    counter = message.split()[1]
    try:
        counter = int(counter)
        if counter >= 100:
            return await eod(e, "**âŒ”âˆ® Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø³Ø¨Ø§Ù… Ø§ÙƒØ«Ø± Ù…Ù† 99 Ø±Ø³Ø§Ù„Ø©**")
    except BaseException:
        return await eod(e, "**âŒ”âˆ® ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø£Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ù…Ø± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­**")
    await e.try_delete()
    await asyncio.wait([asyncio.create_task(e.respond(spam_message)) for i in range(counter)])

@jmthon_cmd(pattern="ÙƒØ±Ø±")
async def spam_with_delay(event):
    try:
        args = event.text.split()
        if event.is_reply:
            if len(args) < 3:
                raise ValueError
            delay = float(args[1])
            count = int(args[2])
            replied_msg = await event.get_reply_message()
            message = replied_msg.text or ""
            media = replied_msg.media
        else:
            if len(args) < 3:
                raise ValueError
            delay = float(args[1])
            count = int(args[2])
            message = ' '.join(args[3:]) if len(args) >=4 else ""
            media = event.media
        
        JmdB.set_key(f"spam_{event.chat_id}", True)
        await event.delete()
        
        for _ in range(count):
            if not JmdB.get_key(f"spam_{event.chat_id}"):
                break
            if media:
                await event.respond(file=media, message=message)
            else:
                await event.respond(message)
            await asyncio.sleep(delay)
            
    except (ValueError, IndexError):
        await event.edit("**âŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø§Ø·Ø¦!**\nØ§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: `.ÙƒØ±Ø± [Ø§Ù„ÙˆÙ‚Øª] [Ø§Ù„Ø¹Ø¯Ø¯]` Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø£Ùˆ `.ÙƒØ±Ø± [Ø§Ù„ÙˆÙ‚Øª] [Ø§Ù„Ø¹Ø¯Ø¯] [Ø§Ù„Ù†Øµ]`")
    except Exception as e:
        LOGS.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙƒØ±Ø§Ø±: {e}")
    finally:
        JmdB.del_key(f"spam_{event.chat_id}")


@jmthon_cmd(pattern="Ø§ÙŠÙ‚Ø§Ù (Ù…ÙƒØ±Ø±|Ù…Ø¤Ù‚Øª)")
async def stop_spam(e):
    if JmdB.get_key(f"spam_{e.chat_id}"):
        JmdB.del_key(f"spam_{e.chat_id}")
        await e.respond("**âŒ”âˆ® ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„ÙˆÙ‚ØªÙŠ Ø¨Ù†Ø¬Ø§Ø­!**")
    else:
        await e.respond("**âŒ”âˆ®Ø£Ù…Ø± Ø§Ù„Ù…ÙƒØ±Ø± Ù„ÙŠØ³ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° Ø­Ø§Ù„ÙŠÙ‹Ø§.**")
